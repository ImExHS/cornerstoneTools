<html>
	<head>
    <style>
      .image-canvas-wrapper {
  width: 812px;
  height: 625px;
  margin: 35px auto;
  background: black;
}

#cornerstone-element {
  width: 100%;
  height: 100%;
}
    </style>
		<!-- include the hammer.js library for touch gestures-->
		<script src="https://unpkg.com/hammerjs@2.0.8/hammer.js"></script>
		<script src="https://unpkg.com/dicom-parser@1.8.3/dist/dicomParser.min.js"></script>

		<!-- include the cornerstone library -->
		<script src="https://unpkg.com/cornerstone-core"></script>
		<script src="https://unpkg.com/cornerstone-math"></script>
		<script src="https://unpkg.com/cornerstone-wado-image-loader"></script>
    <script src="assets/libs/cornerstoneWebImageLoader.js"></script>
		<!-- Why we're all here ;) -->
		<!-- <script src="https://unpkg.com/cornerstone-tools@%5E4"></script> -->

		<script src="dist/cornerstoneTools.min.js"></script>

    
		<!-- include special code for these examples which provides images -->
		<!-- <script src="examples/imageLoader.js"></script> -->
	</head>
	<body>
		<div class="image-canvas-wrapper" >
      <div id="cornerstone-element" class="cornerstone-element"></div>
		</div>
		<script>

			// Externals
			cornerstoneWADOImageLoader.external.cornerstone = cornerstone;
  		cornerstoneWADOImageLoader.external.dicomParser = dicomParser;			
      cornerstoneTools.external.cornerstoneMath = cornerstoneMath;
      cornerstoneWebImageLoader.external.cornerstone = cornerstone;
			cornerstoneTools.external.cornerstone = cornerstone;
			cornerstoneTools.external.Hammer = Hammer;

			const cTools = cornerstoneTools.init({mouseEnabled: true, showSVGCursors: true});
      const element = document.getElementById('cornerstone-element');
   
      cornerstone.enable(element);



			const imageIds = [
      'wadouri:http://127.0.0.1:8080/assets/dicom/01'
				//'wadouri:http://127.0.0.1:8080/assets/dicom/04.dcm'
				//'http://localhost:4200/wado/wado?requestType=WADO&studyUID=&seriesUID=&objectUID=1.3.6.1.4.1.5962.99.1.2280943358.716200484.1363785608958.71.0&contentType=image%2Fjpeg&frameNumber=31'				
			];

			const stack = {
				currentImageIdIndex: 0,
				imageIds: imageIds,
			};

			element.tabIndex = 0;
			element.focus();

			cornerstone.loadImage(imageIds[0]).then(function(image) {
				cornerstoneTools.addStackStateManager(element, ['stack']);
				cornerstoneTools.addToolState(element, 'stack', stack);
        cornerstone.displayImage(element, image);
			});

      element.addEventListener(cornerstoneTools.EVENTS.MEASUREMENT_FINISHED , this.testEvent);

      function testEvent(ev){
        console.log("funciona", ev);
      }
			cTools.addEnabledElement(element);

      const toolName = 'freehandMouse';
			//const toolName = 'probe';

			// Add the tool
			cTools.addToolForElement(element, cornerstoneTools[`${toolName}Tool`]);
			cTools.setToolEnabledForElement(element, toolName);
			cTools.setToolActiveForElement(element, toolName, { mouseButtonMask: 1, isTouchActive: true, isMouseActive: true });

			const test = cTools.getToolForElement(element,toolName);
      console.log("test23       ", test);
		</script>
	</body>
</html>